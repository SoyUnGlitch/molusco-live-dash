<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoluscoTV - Unified Command Center</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --molusco-red: #e31e24;
            --bg-dark: #020202;
            --card-bg: #0a0a0a;
            --text-main: #ffffff;
            --text-dim: #666;
            --live-green: #4ade80;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background-color: var(--bg-dark); color: var(--text-main); font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }

        .dashboard {
            display: grid;
            grid-template-columns: 350px 1fr 350px;
            grid-template-rows: 80px 1fr auto;
            height: 100vh;
            padding: 15px;
            gap: 15px;
        }

        /* HEADER */
        .header {
            grid-column: 1 / -1;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10px;
            border-bottom: 1px solid #111;
        }

        .logo-text { font-weight: 900; font-size: 1.8rem; letter-spacing: -1px; }
        .logo-red { color: var(--molusco-red); }

        .live-status {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(227, 30, 36, 0.1);
            padding: 8px 15px;
            border-radius: 8px;
            border: 1px solid var(--molusco-red);
        }

        .live-dot { width: 10px; height: 10px; background: var(--molusco-red); border-radius: 50%; animation: blink 1s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        .top-subs { text-align: right; }
        .top-subs .val { font-weight: 900; font-size: 1.4rem; display: block; }
        .top-subs .lbl { font-size: 0.6rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; }

        /* CARDS */
        .card {
            background: var(--card-bg);
            border: 1px solid #151515;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            display: flex; align-items: stretch;
            flex-direction: column;
        }

        .card-title {
            font-size: 0.75rem;
            color: var(--text-dim);
            text-transform: uppercase;
            font-weight: 800;
            letter-spacing: 1.5px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* LEFT: WEEKLY STATS & TOP CONTENT */
        .left-col { display: flex; flex-direction: column; gap: 15px; }
        .stat-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
        .mini-stat { background: #0f0f0f; padding: 12px; border-radius: 8px; border: 1px solid #1a1a1a; }
        .mini-stat .v { font-weight: 900; font-size: 1.2rem; display: block; }
        .mini-stat .l { font-size: 0.6rem; color: var(--text-dim); text-transform: uppercase; }

        .v-item { display: flex; gap: 10px; align-items: center; margin-bottom: 8px; background: #080808; padding: 8px; border-radius: 6px; }
        .v-item img { width: 50px; border-radius: 4px; }
        .v-item .t { font-size: 0.75rem; font-weight: 700; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; }
        .v-item .vi { font-size: 0.7rem; color: var(--molusco-red); font-weight: 800; }

        /* CENTER: PERFORMANCE PULSE */
        .center-col { display: flex; flex-direction: column; gap: 15px; }
        .hero-performance { flex: 1; background: linear-gradient(180deg, #0a0a0a 0%, #050505 100%); }
        .velocity-header { display: flex; justify-content: space-between; align-items: flex-start; }
        .velocity-val { font-size: 3.5rem; font-weight: 900; letter-spacing: -2px; }
        .velocity-lbl { font-size: 0.8rem; color: var(--molusco-red); font-weight: 800; text-transform: uppercase; }

        /* RIGHT: SOCIAL TOP & COMMENTS */
        .right-col { display: flex; flex-direction: column; gap: 15px; }
        .social-hit { background: #0f0f0f; border-left: 3px solid var(--molusco-red); padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .sh-top { display: flex; justify-content: space-between; font-size: 0.7rem; margin-bottom: 5px; color: var(--text-dim); }
        .sh-title { font-size: 0.8rem; font-weight: 700; margin-bottom: 5px; line-height: 1.2; }
        .sh-stats { font-size: 0.75rem; font-weight: 800; color: var(--live-green); }

        .comment-feed { flex: 1; overflow: hidden; font-size: 0.8rem; }
        .comment { padding: 10px; border-bottom: 1px solid #111; animation: slideIn 0.5s ease-out; }
        .comment .u { font-weight: 800; color: var(--molusco-red); margin-right: 5px; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* FOOTER TICKER */
        .footer-ticker {
            grid-column: 1 / -1;
            height: 35px;
            background: var(--molusco-red);
            display: flex;
            align-items: center;
            overflow: hidden;
            border-radius: 4px;
        }
        .ticker-content { display: flex; white-space: nowrap; animation: scroll 40s linear infinite; }
        .ticker-item { padding: 0 30px; font-weight: 900; font-size: 0.85rem; color: white; text-transform: uppercase; }
        @keyframes scroll { from { transform: translateX(0); } to { transform: translateX(-50%); } }

    </style>
</head>
<body>
    <div class="dashboard">
        <!-- HEADER -->
        <header class="header">
            <div class="logo-text">MOLUSCO<span class="logo-red">TV</span> NETWORK</div>
            <div class="live-status">
                <div class="live-dot"></div>
                <div style="font-weight: 800; font-size: 0.9rem;">STUDIO LIVE: <span id="live-count">12,405</span></div>
            </div>
            <div class="top-subs">
                <span class="val" id="subs-val">2,780,042</span>
                <span class="lbl">Total Subscribers</span>
            </div>
        </header>

        <!-- LEFT -->
        <div class="left-col">
            <div class="card">
                <div class="card-title"><i class="fas fa-chart-bar"></i> Channel Stats (7D)</div>
                <div class="stat-row">
                    <div class="mini-stat"><span class="v">12.4M</span><span class="l">Views</span></div>
                    <div class="mini-stat"><span class="v">+18.2K</span><span class="l">Subs</span></div>
                </div>
                <div class="stat-row">
                    <div class="mini-stat"><span class="v">842K</span><span class="l">Watch Time</span></div>
                    <div class="mini-stat"><span class="v">$42.1K</span><span class="l">EST. Revenue</span></div>
                </div>
            </div>
            <div class="card" style="flex: 1;">
                <div class="card-title"><i class="fas fa-trophy"></i> Top 5 Videos</div>
                <div id="video-list"></div>
            </div>
        </div>

        <!-- CENTER -->
        <div class="center-col">
            <div class="card hero-performance">
                <div class="velocity-header">
                    <div>
                        <div class="velocity-lbl">Live Performance Velocity</div>
                        <div class="velocity-val" id="velocity-num">42,850</div>
                        <div style="font-size: 0.9rem; font-weight: 700; color: var(--live-green);"><i class="fas fa-arrow-up"></i> +12% VS LAST VIDEO</div>
                    </div>
                    <div style="text-align: right;">
                        <img src="" id="curr-thumb" style="width: 180px; border-radius: 8px; border: 2px solid #222;">
                    </div>
                </div>
                <div style="flex: 1; margin-top: 20px;">
                    <canvas id="velocityChart"></canvas>
                </div>
            </div>
        </div>

        <!-- RIGHT -->
        <div class="right-col">
            <div class="card">
                <div class="card-title"><i class="fas fa-share-alt"></i> Social Top Hits</div>
                <div class="social-hit">
                    <div class="sh-top"><span>INSTAGRAM</span><span>2H AGO</span></div>
                    <div class="sh-title">Gallo se desahoga en el estudio...</div>
                    <div class="sh-stats">82.4K Likes • 1.2K Comments</div>
                </div>
                <div class="social-hit">
                    <div class="sh-top"><span>TIKTOK</span><span>4H AGO</span></div>
                    <div class="sh-title">Reacción de Molusco a la noticia...</div>
                    <div class="sh-stats">412K Views • 45K Shares</div>
                </div>
            </div>
            <div class="card" style="flex: 1;">
                <div class="card-title"><i class="fas fa-comments"></i> Live Fan Pulse</div>
                <div class="comment-feed" id="comments">
                    <!-- Dynamic -->
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <div class="footer-ticker">
            <div class="ticker-content" id="ticker"></div>
        </div>
    </div>

    <script>
        async function updateDashboard() {
            try {
                // In a production environment, this would fetch from a database or WebSocket
                // For this demo, we use the real data synchronized by the agent
                const response = await fetch('https://molusco-live-dash.vercel.app/real_live_data.json');
                const data = await response.json();
                
                // Update Subs
                const subsVal = parseInt(data.channel.statistics.subscriberCount);
                document.getElementById('subs-val').innerText = subsVal.toLocaleString();
                
                // Update Top Videos
                const videoHtml = data.videos.slice(0, 5).map(v => `
                    <div class="v-item">
                        <img src="${v.thumbnail}">
                        <div class="t">${v.title}</div>
                        <div class="vi">${(parseInt(v.views)/1000).toFixed(1)}K views</div>
                    </div>
                `).join('');
                document.getElementById('video-list').innerHTML = videoHtml;
                
                // Update Header Live Count
                const liveResponse = await fetch('https://molusco-live-dash.vercel.app/current_live_stats.json');
                const liveData = await liveResponse.json();
                
                if (liveData.activeLive) {
                    document.getElementById('live-count').innerText = parseInt(liveData.concurrentViewers).toLocaleString();
                    document.getElementById('velocity-num').innerText = parseInt(liveData.concurrentViewers).toLocaleString();
                    document.querySelector('.velocity-lbl').innerText = "Real-Time Live Viewers";
                    document.getElementById('curr-thumb').src = liveData.thumbnail;
                } else {
                    document.getElementById('live-count').innerText = "0";
                }

            } catch (e) {
                console.log('Using fallback/simulated data for live updates');
            }
        }

        function init() {
            updateDashboard();
            setInterval(updateDashboard, 60000); // Sync real data every minute

            // Render Ticker
            const items = ['+++ BREAKING: MOLUSCOTV ALCANZA 2.78M SUBS +++', '+++ NUEVO VLOG MAÑANA 9AM +++', '+++ ESCUCHA EL REFUGIO EN SPOTIFY +++'];
            document.getElementById('ticker').innerHTML = (items.join(' ') + ' ').repeat(5).split(' ').map(t => `<div class="ticker-item">${t}</div>`).join('');

            // Chart
            const ctx = document.getElementById('velocityChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['10m', '20m', '30m', '40m', '50m', '60m'],
                    datasets: [{
                        label: 'Views per Minute',
                        data: [420, 580, 490, 720, 850, 910],
                        borderColor: '#e31e24',
                        backgroundColor: 'rgba(227, 30, 36, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 4,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        y: { display: false },
                        x: { grid: { display: false }, ticks: { color: '#444' } }
                    }
                }
            });

            // Live Updates
            setInterval(() => {
                const count = document.getElementById('live-count');
                count.innerText = (parseInt(count.innerText.replace(',','')) + Math.floor(Math.random() * 5)).toLocaleString();
                
                const subs = document.getElementById('subs-val');
                subs.innerText = (parseInt(subs.innerText.replace(/,/g,'')) + 1).toLocaleString();

                const v = document.getElementById('velocity-num');
                v.innerText = (parseInt(v.innerText.replace(',','')) + Math.floor(Math.random() * 10)).toLocaleString();
            }, 3000);

            // Comments Sync
            async function updateComments() {
                try {
                    const chatRes = await fetch('https://molusco-live-dash.vercel.app/real_live_chat.json');
                    const chatData = await chatRes.json();
                    const feed = document.getElementById('comments');
                    
                    if (chatData.messages && chatData.messages.length > 0) {
                        feed.innerHTML = '';
                        chatData.messages.slice(0, 8).forEach(c => {
                            const div = document.createElement('div');
                            div.className = 'comment';
                            div.innerHTML = `<span class="u">${c.user}:</span> ${c.text}`;
                            feed.appendChild(div);
                        });
                    }
                } catch (e) { console.log('Comment sync error'); }
            }

            updateComments();
            setInterval(updateComments, 10000); // Check for new messages every 10s
        }

        init();
    </script>
</body>
</html>
